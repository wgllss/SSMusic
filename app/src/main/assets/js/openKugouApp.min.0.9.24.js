!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).openKugouApp=e()}(this,function(){"use strict";function n(e){var n="cb"+(new Date).getTime();window[n]=function(n){"string"==typeof n?e.success(JSON.parse(n)):e.success(n)};var t,i=document.createElement("script");for(t in i.src=e.url+"&callback="+n,e.data)i.src+="&"+t+"="+e.data[t];document.getElementsByTagName("body")[0].appendChild(i)}var e=(window.kgWxEnvir||(window.kgWxEnvir=new t,window.hash=window.location.hash,"onhashchange"in window&&(void 0===document.documentMode||8==document.documentMode)?window.onhashchange=function(){window.kgWxEnvir.hasCheck=!1,window.kgWxEnvir.hasRegister=!1,window.kgWxEnvir.hasReady=!1,window.kgWxEnvir.init()}:setInterval(function(){window.location.hash!=window.hash&&(window.hash=window.location.hash,window.kgWxEnvir.hasCheck=!1,window.kgWxEnvir.hasRegister=!1,window.kgWxEnvir.hasReady=!1,window.kgWxEnvir.init())},150)),t.prototype.init=function(n,e){n&&n.jsApiList&&Array.isArray(n.jsApiList)&&(this.jsApiList=this.jsApiList.concat(n.jsApiList)),n&&n.version&&(this.version=n.version),-1!=window.location.origin.indexOf("kugou.com")?this.this_url=encodeURIComponent(window.location.href):this.this_url=encodeURIComponent("http://kugou.com");var t=this;t.loadWxJs(function(){t.hasReady?e&&e(window.wx):/MicroMessenger/i.test(navigator.userAgent)&&(t.cbBus.push(e),t.hasCheck||(t.wxRegisterTimeout&&clearTimeout(t.wxRegisterTimeout),t.wxRegisterTimeout=setTimeout(function(){t.hasCheck=!0,t.getSignature()},500)))})},t.prototype.loadWxJs=function(n){var e;window.wx||this.hasLoadJS?n&&n():(this.hasLoadJS=!0,(e=document.createElement("script")).type="text/javascript",e.readyState?e.onreadystatechange=function(){"loaded"!=e.readyState&&"complete"!=e.readyState||(e.onreadystatechange=null,n&&n())}:e.onload=function(){n&&n()},"1.6"===this.version?e.src="https://staticssl.kugou.com/common/js/kg-jweixin-1.6.0.js":e.src="https://staticssl.kugou.com/common/js/kg-jweixin-1.4.0.js",document.getElementsByTagName("head")[0].appendChild(e))},t.prototype.getSignature=function(){var e=this;e.useNewShare?(e.jsApiList.push("updateAppMessageShareData"),e.jsApiList.push("updateTimelineShareData"),n({url:"https://mwechats.kugou.com/service/jssdk/getSignature?sdk=140&caller=kugou_web&url="+e.this_url,success:function(n){n&&(window.wx.config({beta:!0,debug:!1,appId:n.appId,timestamp:n.timestamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:e.jsApiList}),e.hasRegister=!0,window.wx.ready(function(){e.hasReady=!0,e.cbBus.forEach(function(n){n&&n(window.wx)})}))}})):n({url:"https://mwechats.kugou.com/jssdk/getSignature?sdk=140&caller=kugou_mobile&url="+e.this_url,success:function(n){n&&(window.wx.config({debug:!1,beta:!0,appId:n.appId,timestamp:n.timestamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:e.jsApiList}),e.hasRegister=!0,window.wx.ready(function(){e.hasReady=!0,e.cbBus.forEach(function(n){n&&n(window.wx)})}))}})},t.prototype.share=function(n){if(!this.hasRegister)return"还未完成初始化，请在init回调中调用share方法";window.wx.ready(function(){window.wx.onMenuShareAppMessage({title:n.title,desc:n.content,link:n.url,imgUrl:n.img,trigger:function(n){},success:function(n){},cancel:function(n){},fail:function(n){}}),window.wx.onMenuShareTimeline({title:n.title,desc:n.content,link:n.url,imgUrl:n.img,trigger:function(n){},success:function(n){},cancel:function(n){},fail:function(n){}}),window.wx.onMenuShareQQ({title:n.title,desc:n.content,link:n.url,imgUrl:n.img,success:function(){},cancel:function(){}}),window.wx.onMenuShareQZone({title:n.title,desc:n.content,link:n.url,imgUrl:n.img,success:function(){},cancel:function(){}}),window.wx.onMenuShareWeibo({title:n.title,desc:n.content,link:n.url,imgUrl:n.img,success:function(){},cancel:function(){}})})},{init:function(n,e){window.kgWxEnvir.init(e,n)},share:function(n){window.kgWxEnvir.share(n)},getUserInfo:function(){if(/MicroMessenger/i.test(navigator.userAgent)){var n;if(-1==(t=""==(t=decodeURIComponent(window.location.search))&&window.location.hash&&-1!=window.location.hash.indexOf("?")?"?"+decodeURIComponent(window.location.hash).split("?")[1]:t).indexOf("openid")||-1==t.indexOf("unionid"))return void(window.location.href=(o=window.location.href,"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx412c15698d95020e&redirect_uri="+encodeURIComponent("https://mwechats.kugou.com/service/user/getInfo?redirect_uri="+encodeURIComponent(o))+"&response_type=code&scope=snsapi_userinfo&state=1&connect_redirect=1#wechat_redirect"));for(var e={openid:"",unionid:"",nickname:"",sex:"",city:"",province:"",country:"",headimgurl:""},t=t.substr(1).split("&"),i=0;i<t.length;i++)1<(n=(n=-1!=(n=t[i]).indexOf("openid")?n.substring(n.indexOf("openid")):n).split("=")).length&&null!=e[n[0]]&&(e[n[0]]=n[1]);return e}var o;return null}});function t(){var n=window.location.host;-1==["m3ws.kugou.com","ep.kugou.com","activity.kugou.com","h5.kugou.com","m.kugou.com"].join(",").indexOf(n)&&-1!=["m3ws.kugou.com","mtpls.kugou.com","h5.kugou.com","m.kugou.com"].join(",").indexOf(n)?this.useNewShare=!0:this.useNewShare=!1,this.hasCheck=!1,this.hasRegister=!1,this.hasReady=!1,this.cbBus=[],this.jsApiList=["launchApplication","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"],this.version="1.4"}var o=arguments,u={getSysBowser:function(){function n(n){return t.match(n)}var e=new Array(2),t=navigator.userAgent.toLocaleLowerCase();return n(/android/i)?e[0]=1:n(/iphone/i)||n(/KGBrowser/i)?e[0]=2:n(/ipad/i)?e[0]=3:e[0]=4,n(/kgbrowser/gi)||u.safeGetJson(window,"external","superCall")?e[1]=1:n(/micromessenger/gi)&&!n(/wxwork/gi)?e[1]=2:n(/micromessenger/gi)&&n(/wxwork/gi)?e[1]=7:n(/android/i)&&n(/qq/gi)&&n(/mqqbrowser/gi)||(n(/iphone/i)||n(/ipad/i))&&n(/ qq/gi)?e[1]=3:n(/weibo/gi)?e[1]=4:n(/fanxing/gi)?e[1]=5:n(/kgshortvideo/gi)?e[1]=6:e[1]=100,e},safeGetJson:function(n){try{for(var e=o.length,t=new Array(1<e?e-1:0),i=1;i<e;i++)t[i-1]=o[i];return arr.reduce(function(n,e){return n[e]},n)}catch(n){return 0}},jsonp:function(o,s){return new Promise(function(n,e){var t="jsonCallBack"+parseInt(1e9*Math.random()+0,10);window[t]=function(n){s&&s(n)};var i=document.createElement("script");i.type="text/javascript",i.src="".concat(o,"&callback=").concat(t),document.getElementsByTagName("head")[0].appendChild(i),setTimeout(function(){document.getElementsByTagName("head")[0].removeChild(i)},1e3)})},initWXSign:function(n){e.init(function(){n&&n()})},isWechatWhiteList:function(){for(var n=["https://m3ws.kugou.com","https://ep.kugou.com","https://activity.kugou.com","https://m.kugou.com","https://h5.kugou.com"],e=window.location.protocol+"//"+window.location.host,t=n.length;t--;)if(n[t]===e)return!0;return!1},getUrlParam:function(n){var e="",t=window.location.href,i=t.indexOf("?"),o=t.indexOf("#");0<=i&&-1==o&&(e=t.substr(i)),0<=o&&-1==i&&(e=""),0<=o&&0<=i&&o<i&&(e=t.substr(i));var s={};if(-1!=(e=0<=o&&0<=i&&i<o?t.substr(i,o-i):e).indexOf("?"))for(var c=e.substr(1).split("&"),r=0;r<c.length;r++)s[c[r].split("=")[0]]=c[r].split("=")[1];return s[n]},getHidden:function(){var n;return void 0!==document.hidden?n="hidden":void 0!==document.mozHidden?n="mozHidden":void 0!==document.msHidden?n="msHidden":void 0!==document.webkitHidden&&(n="webkitHidden"),document[n]},checkOpen:function(n){var e,t=null,i=0,t=window.setInterval(function(){if(i++,(e=document.hidden||document.webkitHidden||document.mozHidden||document.msHidden)||50<i){if(clearInterval(t),e)return null;n(e)}},50)}},d=function(n,e,t,i){i=encodeURIComponent(JSON.stringify({cmd:n,jsonStr:i,type:e,action:t})),e="kugou://start.weixin?"+i,t="kugouurl://start.weixin?"+i,i="",i=1==u.getSysBowser()[0]?e:t;window.location.href=i},h=function(n,e,t,i,o){var s={cmd:n,jsonStr:i,type:e,action:t};u.initWXSign(function(){try{var n={is_start_weixin:!0,real_content:"kugou://start.weixin?"+JSON.stringify(s)};wx.invoke("launchApplication",{appID:"wx79f2c4418704b4f8",parameter:"kugouurl://start.weixin?"+encodeURIComponent(JSON.stringify(s)),extInfo:"kugouURL://start.fanxing?"+encodeURIComponent(JSON.stringify(n))},function(n){"launchApplication:ok"===n.err_msg||(n.err_msg,o&&o())})}catch(n){o&&o()}})},l=function(n,e,t,i){t=encodeURIComponent(JSON.stringify({cmd:n,jsonStr:i,type:e,action:t}));window.location.href="https://m3ws.kugou.com/share/weixin.html?data="+t},p=function(n,e,t,i){i=encodeURIComponent(JSON.stringify(i));window.location.href="https://mo.kugou.com/universal/?Type="+e+"&Action="+t+"&Json="+i},w=function(n,e,t,i,o){o=o||"CK1350585625598";t="kugou://start.weixin?"+encodeURIComponent(JSON.stringify({cmd:n,jsonStr:i,type:e,action:t})),o="https://a.app.qq.com/o/simple.jsp?pkgname=com.kugou.android&ckey=".concat(o);window.location.href=o+"&android_schema="+t+"&schema_version=7950"},g=function(n,e,t,i,o){t=encodeURIComponent(JSON.stringify({cmd:n,jsonStr:i,type:e,action:t}));window.location.href=(o||"https://itunes.apple.com/app/apple-store/id472208016?pt=624347&ct=schoolstar&mt=8")+"&android_schema="+("kugouurl://start.weixin?"+t)+"&schema_version=7950"},m=function(){var n=document.getElementById("pop_mask2");n?n.style.display="block":((n=document.createElement("div")).classList.add("pop_mask2"),n.setAttribute("style","width: 100%; height: 100%; z-index: 9999; position: fixed; top: 0; left: 0; display: none;"),n.setAttribute("id","pop_mask2"),document.body.appendChild(n),n.innerHTML='<img style="width: 100%; height: 100%; display: block;" src="https://webimg.kgimg.com/acf6178e56ecd99bee6b013d39061689.png"/>'),n.addEventListener("click",function(){this.style.display="none"},!1),n.style.display="block"},f=function(n){return window.location.href="http://downmobile.kugou.com/promote/package/download/channel="+n,null},k=(navigator.userAgent.toLocaleLowerCase(),2==u.getSysBowser()[1]),y=3==u.getSysBowser()[1],v=4==u.getSysBowser()[1],x=2==u.getSysBowser()[0]||3==u.getSysBowser()[0],S=7==u.getSysBowser()[1];k&&u.initWXSign();return function(n,e,t,i,o,s){var c,r,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:{};if(a||(a.autoOpenInWeChat=!1),a&&a.friendship&&(c=u.getUrlParam("u"),r=u.getUrlParam("kgsscty1"),c&&i&&!i.u&&(i.u=c),r&&i&&!i.kgsscty1&&(i.kgsscty1=r)),a.autoOpenInWeChat&&k&&u.isWechatWhiteList())return h(n,e,t,i,function(){return a.openByWeChatFailCallback&&a.openByWeChatFailCallback(),null}),null;if(k)u.isWechatWhiteList()?h(n,e,t,i,function(){return m(),null}):(!x||"cmd"==o?l:p)(n,e,t,i);else if(y)if(x){if("mokugou"==o)return p(n,e,t,i),null;d(n,e,t,i),u.checkOpen(function(){g(n,e,t,i,a.iosAppstoreUrl)})}else d(n,e,t,i),u.checkOpen(function(){w(n,e,t,i,s)});else if(v)if(x){if("mokugou"==o)return m(),null;d(n,e,t,i),u.checkOpen(function(){g(n,e,t,i,a.iosAppstoreUrl)})}else d(n,e,t,i),u.checkOpen(function(){var n="271";a&&a.chi&&(n=a.chi),f(n)});else S?m():x?"cmd"==o?(d(n,e,t,i),u.checkOpen(function(){g(n,e,t,i,a.iosAppstoreUrl)})):p(n,e,t,i):(d(n,e,t,i),u.checkOpen(function(){w(n,e,t,i,s)}))}});
//# sourceMappingURL=main.min.js.map
